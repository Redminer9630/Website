<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>PI5-LED Steuerung</title>
<style>
body { font-family: Arial, sans-serif; background:#1e1e1e; color:#eee; text-align:center; padding:20px; }
h1,h2 { color:#ffcc00; }
button { margin:5px; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; transition:0.2s; }
button:hover { opacity:0.8; }
.on { background:#4caf50; color:#fff; }
.off { background:#f44336; color:#fff; }
.prog { background:#2196f3; color:#fff; }
.pattern { background:#ff9800; color:#fff; }
input { margin:10px; padding:8px; width:250px; border-radius:5px; border:1px solid #555; background:#333; color:#fff; text-align:center; }
#status { margin-top:15px; font-weight:bold; }
.container { display:inline-block; text-align:left; background:#2b2b2b; padding:20px; border-radius:10px; }
.preset { cursor:pointer; text-decoration:underline; color:#ffcc00; }

#modal {
  display:none; position:fixed; z-index:1000; left:50%; top:50%; transform:translate(-50%,-50%);
  background:#333; padding:20px; border-radius:10px; border:2px solid #ffcc00; color:#fff;
  box-shadow:0 0 15px rgba(255,204,0,0.5);
}
.spinner {
  border:4px solid #f3f3f3; border-top:4px solid #ffcc00; border-radius:50%; width:20px; height:20px;
  animation:spin 1s linear infinite; display:inline-block; margin-right:10px;
}
@keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
</style>
</head>
<body>
<h1>PI5-LED Steuerung</h1>
<div class="container">
  <h2>Standard Modi</h2>
  <button class="off" onclick="setMode('off');setPatternInput('0')">LED Aus</button>
  <button class="on" onclick="setMode('on');setPatternInput('1')">LED An</button>
  <button class="prog" onclick="setMode('blink_programs');setPatternInput('programs')">Programme blinken</button>

  <h2>Eigenes Blinkmuster</h2>
  <p>Pattern eingeben (Sekunden, mit Kommas trennen, Start = AN, dann AUS usw.)</p>
  <input id="patternInput" value="0.2,0.2,1.0,0.5">
  <button class="pattern" onclick="sendPattern()">Muster senden</button>

  <p>Presets: 
    <span class="preset" onclick="setPatternInput('0.1,0.1')">Schnelles Blinken</span> | 
    <span class="preset" onclick="setPatternInput('0.5,0.5')">Langsames Blinken</span> | 
    <span class="preset" onclick="setPatternInput('1,0.5,0.2,0.2')">Signal</span>
  </p>
  <p id="status"></p>
</div>

<div id="modal"><span class="spinner"></span><span id="modalText">Sende Request...</span></div>

<script>
const PI_IP = "http://PI_IP:5000";

function showModal(text){
  document.getElementById("modalText").innerText = text;
  document.getElementById("modal").style.display = "block";
}
function hideModal(){
  document.getElementById("modal").style.display = "none";
}

function setMode(mode){
  showModal("Sende Request...");
  fetch(`${PI_IP}/led2/${mode}`)
    .then(res => res.text())
    .then(txt => { hideModal(); document.getElementById("status").innerText = txt; })
    .catch(err => { hideModal(); document.getElementById("status").innerText = "Fehler: " + err; });
}

function sendPattern(){
  showModal("Sende Request...");
  let input = document.getElementById("patternInput").value;
  if(input === '0'){ input = []; } 
  else if(input === '1'){ input = [1]; }
  else if(input === 'programs'){ input = "programs"; }
  else { input = input.split(",").map(x=>parseFloat(x.trim())).filter(x=>!isNaN(x)); }

  fetch(`${PI_IP}/led2/pattern`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({pattern: input})
  })
  .then(res => res.text())
  .then(txt => { hideModal(); document.getElementById("status").innerText = txt; })
  .catch(err => { hideModal(); document.getElementById("status").innerText = "Fehler: " + err; });
}

function setPatternInput(val){
  document.getElementById("patternInput").value = val;
  sendPattern();
}
</script>
</body>
</html>
