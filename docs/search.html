<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Suche – Redminer9630</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: 'Mojangles', system-ui, sans-serif; background: #eaeaea; margin: 1rem; }
    h1 { margin-bottom: 1rem; }
    #search-section { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-bottom: 1rem; }
    #search-wrapper { flex: 1; min-width: 220px; position: relative; }
    #search-input {
      width: 100%;
      padding: 0.5rem 2rem 0.5rem 0.5rem;
      font-size: 1rem;
      font-family: 'Mojangles', system-ui, sans-serif;
      box-sizing: border-box;
    }
    #clear-btn {
      position: absolute;
      right: .4rem;
      top: 50%;
      transform: translateY(-50%);
      border: none; background: transparent;
      font-size: 1.1rem; line-height: 1;
      cursor: pointer; display: none; user-select: none;
    }
    #clear-btn:hover { color: red; }
    button {
      background: #eaeaea; color: black;
      padding: 10px 20px; border: none; cursor: pointer;
      font-family: 'Mojangles', system-ui, sans-serif; font-size: 1rem;
    }
#search-input {
  width: 100%;
  padding: 0.5rem 2rem 0.5rem 0.5rem;
  font-size: 1rem;
  font-family: 'Mojangles', system-ui, sans-serif;
  box-sizing: border-box;
  border: none;
  outline: none;
  background-clip: padding-box;
}
    button:hover { background: #cacaca; }
    #results { margin-top: 1rem; }
    .no-results { color: #888; font-style: italic; margin-top: 1rem; }
    .result-item { opacity: 0; transform: translateY(10px); animation: fadeInUp 0.4s ease forwards; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    #search-suggestions {
      position: absolute; top: calc(100% + 4px); left: 0; right: 0;
      border: 1px solid #ccc; background: #fff; z-index: 10;
    }
    #search-suggestions .item {
      display: flex; justify-content: space-between; align-items: center;
      padding: .35rem .55rem; cursor: pointer; gap: .5rem;
    }
    #search-suggestions .item:hover { background: #eee; }
    #search-suggestions .remove { cursor: pointer; color: red; font-weight: bold; user-select: none; }
    :root[data-theme="dark"] body { background: #1a1a1a; color: #eee; }
    :root[data-theme="dark"] #search-input { background: #222; color: #eee; border: 1px solid #444; }
    :root[data-theme="dark"] button { background: #1a1a1a; color: white; }
    :root[data-theme="dark"] button:hover { background: #3a3a3a; }
    :root[data-theme="dark"] #results { color: #ccc; }
    :root[data-theme="dark"] .no-results { color: #666; }
    :root[data-theme="dark"] #search-suggestions { background:#222; border:1px solid #444; color:#eee; }
    :root[data-theme="dark"] #search-suggestions .item:hover { background:#333; }
    :root[data-theme="dark"] #search-suggestions .remove { color:#f66; }
    #search-input::-webkit-search-decoration { -webkit-appearance: searchfield-decoration; }
    :root[data-theme="dark"] #search-input::-webkit-search-decoration { filter: invert(1) brightness(1.5); }
  </style>
  <script src="https://cdn.jsdelivr.net/gh/Redminer9630/Website@t55/docs/autoloader.js" type="module" defer></script>
</head>
<body>
  <h1>Suche</h1>

  <section id="search-section">
    <div id="search-wrapper">
      <input id="search-input" type="search" aria-label="Suche..." placeholder="Suchbegriff eingeben" />
      <div id="search-suggestions" aria-label="Suchvorschläge"></div>
    </div>
    <button id="search-button">Suchen</button>
  </section>

  <div id="results"></div>

<script>
const input = document.getElementById("searchInput");
const searchBtn = document.getElementById("searchBtn");
const results = document.getElementById("results");
const suggestionsBox = document.getElementById("suggestions");

function saveHistory(term) {
  let history = JSON.parse(localStorage.getItem("searchHistory")) || [];
  if (!history.includes(term)) {
    history.unshift(term);
    if (history.length > 10) history.pop();
    localStorage.setItem("searchHistory", JSON.stringify(history));
  }
}

function loadSuggestions() {
  let history = JSON.parse(localStorage.getItem("searchHistory")) || [];
  suggestionsBox.innerHTML = "";
  history.forEach(item => {
    const div = document.createElement("div");
    div.className = "suggestion";
    div.textContent = item;
    div.onclick = () => {
      input.value = item;
      searchBtn.click();
    };
    suggestionsBox.appendChild(div);
  });
}

function runSearch(term) {
  results.innerHTML = "<p>Suche läuft...</p>";

  fetch("/crawl/index.json")
    .then(res => res.json())
    .then(data => {
      results.innerHTML = "";
      let matches = [];

      Object.values(data).forEach(entry => {
        if (
          entry.title.toLowerCase().includes(term.toLowerCase()) ||
          (entry.aliases && entry.aliases.some(a => a.toLowerCase().includes(term.toLowerCase()))) ||
          entry.text.toLowerCase().includes(term.toLowerCase())
        ) {
          matches.push(entry);
        }
      });

      if (matches.length === 0) {
        results.innerHTML = "<p>Keine Treffer gefunden.</p>";
      } else {
        matches.forEach(m => {
          const div = document.createElement("div");
          div.className = "result";
          div.innerHTML = `<h3>${m.title}</h3><p>${m.text.slice(0,150)}...</p>`;
          results.appendChild(div);
        });
      }
    })
    .catch(err => {
      results.innerHTML = `<p style="color:red;">Fehler: ${err}</p>`;
    });
}

searchBtn.addEventListener("click", () => {
  const term = input.value.trim();
  if (term) {
    history.replaceState(null, "", "?q=" + encodeURIComponent(term));
    runSearch(term);
    saveHistory(term);
    loadSuggestions();
  } else {
    results.innerHTML = "";
  }
});

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    searchBtn.click();
  }
});

window.addEventListener("load", () => {
  const params = new URLSearchParams(window.location.search);
  const q = params.get("q");
  if (q) {
    input.value = q;
    runSearch(q);
  }
  loadSuggestions();
});
</script>
</body>
</html>
