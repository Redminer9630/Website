<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Suche – Redminer9630</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    body { font-family:Mojangles; background:#eaeaea; margin:1rem; color:#000; }
    h1 { margin-bottom:1rem; }
    #search-section { display:flex; gap:.6rem; align-items:stretch; margin-bottom:1rem; position:relative; }
    #search-wrapper { flex:1; min-width:220px; position:relative; }
    #search-input {
      width:100%; padding:.5rem .6rem; font-size:1rem; box-sizing:border-box;
      border:1px solid transparent; border-radius:6px; outline:none; background-clip:padding-box; height:44px;
      background:#fff; color:#000;
    }
    #search-suggestions {
      position:absolute; top:calc(100% + 6px); left:0; right:0; z-index:20;
      border:1px solid #ccc; background:#fff; box-shadow:0 6px 18px rgba(0,0,0,.06);
      border-radius:4px; padding:0; display:none;
      max-height:176px;
      overflow-y:auto;
    }
    #search-suggestions .item {
      display:flex; justify-content:space-between; gap:.5rem;
      padding:0 .6rem; cursor:pointer; align-items:center;
      font-size:1rem; height:44px; line-height:44px;
    }
    #search-button, #filter-button {
      font-family: inherit;
      font-size: 16px;
      background-color: #1a1a1a;
      color: #fff;
      padding: 0 20px;
      border-radius:6px;
      border: 1px solid #eaeaea;
      cursor: pointer;
      height:44px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      line-height:1;
    }
    #search-button:hover, #filter-button:hover { opacity:.95; }
    #results { margin-top:1rem; }
    .no-results { color:#666; font-style:italic; }
    .result-item { padding:.6rem 0; animation: fadeInUp .24s ease both; }
    .result-sep { border:none; border-top:1px solid #e0e0e0; margin:.5rem 0; animation: fadeInUp .24s ease both; }
    @keyframes fadeInUp { from { opacity:0; transform:translateY(6px);} to { opacity:1; transform:none; } }
    mark { background:#fffb91; color:inherit; padding:0; box-decoration-break:clone; }

    #search-suggestions .item:hover { background:#f3f3f3; }
    #search-suggestions .remove {
      color:#c33; cursor:pointer; margin-left:.5rem; user-select:none; display:inline-flex; align-items:center; height:20px;
      font-weight:700; line-height:1; transform: translateY(-1px);
    }

    /* Filtermenü */
    #filter-container { position:relative; }
    #filter-menu {
      position:absolute; top:calc(100% + 6px); left:0; z-index:30;
      background:#fff; border:1px solid #ccc; padding:.6rem; border-radius:6px;
      box-shadow:0 4px 12px rgba(0,0,0,.1); display:none; min-width:180px;
    }
    #filter-menu label { display:flex; align-items:center; gap:.5rem; margin-bottom:.4rem; font-size:.95rem; cursor:pointer; }
    #filter-menu i { color:#333; width:20px; text-align:center; }
    #filter-menu input[type="radio"] { transform:scale(1.2); }
    :root[data-theme="dark"] body { background:#101010; color:#eee; }
    :root[data-theme="dark"] #search-input { background:#111; color:#eee; border-color:#333; }
    :root[data-theme="dark"] #search-suggestions { background:#111; border:1px solid #333; color:#eee; box-shadow:none; }
    :root[data-theme="dark"] #search-suggestions .item:hover { background:#1a1a1a; }
    :root[data-theme="dark"] mark { background:#5a5a1e; }
    :root[data-theme="dark"] #filter-menu { background:#111; border-color:#333; color:#eee; }
    .result-item .title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.2rem; }
    .result-item .desc { font-size: 1rem; color: #444; line-height: 1.4; }
  </style>
  <script type="module" defer src="https://cdn.jsdelivr.net/gh/Redminer9630/Website@t73/docs/autoloader.js"></script>
</head>
<body>
  <h1>Suche</h1>

  <section id="search-section">
    <div id="search-wrapper">
      <input id="search-input" type="search" autocomplete="off" placeholder="Suchbegriff eingeben" />
      <div id="search-suggestions" aria-label="Suchvorschläge"></div>
    </div>
    <div id="filter-container">
      <button id="filter-button" title="Filter"><i class="fa-solid fa-filter"></i></button>
      <div id="filter-menu">
        <label><input type="radio" name="filter-pos" value="left"> <i class="fa-solid fa-align-left"></i> Muss am Anfang stehen</label>
        <label><input type="radio" name="filter-pos" value="middle"> <i class="fa-solid fa-align-center"></i> Muss irgendwo drin sein</label>
        <label><input type="radio" name="filter-pos" value="right"> <i class="fa-solid fa-align-right"></i> Muss am Ende stehen</label>
        <label><input type="radio" name="filter-pos" value="any" checked> <i class="fa-solid fa-arrows-left-right"></i> Egal wo</label>
      </div>
    </div>
    <button id="search-button">Suchen</button>
  </section>

  <div id="results"></div>

<script>
  const JSON_FILES = [
    "search/index.json",
    "search/discord.json",
    "search/news.json",
    "search/projects.json",
    "search/linktree.json",
    "search/manual.json"
  ];

  const input = document.getElementById("search-input");
  const searchBtn = document.getElementById("search-button");
  const results = document.getElementById("results");

  const normalize = t => (t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
  const isValidQuery = q => typeof q === "string" && q.trim().length > 0;

  let cacheData = null;
  async function loadAllData(){
    if (cacheData) return cacheData;
    const responses = await Promise.all(JSON_FILES.map(f => fetch(f).catch(()=>null)));
    const jsons = await Promise.all(responses.map(r => r && r.ok ? r.json() : []));
    const merged = [];
    jsons.forEach(j => { if (Array.isArray(j)) merged.push(...j); });
    cacheData = merged;
    return cacheData;
  }

  function haystackOfEntry(entry){
    return normalize([entry.title||"", entry.desc||"", ...(entry.alias||[])].join(" "));
  }

  function getFilterMode(){
    const checked = document.querySelector("#filter-menu input[name='filter-pos']:checked");
    return checked ? checked.value : "any";
  }

  async function runSearch(term){
    results.innerHTML = "";
    if(!isValidQuery(term)) return;

    const allData = await loadAllData();
    const qNorm = normalize(term.trim());
    const mode = getFilterMode();

    let found = allData.filter(e=>{
      const hay = haystackOfEntry(e);
      switch(mode){
        case "left": return hay.startsWith(qNorm);
        case "right": return hay.endsWith(qNorm);
        case "middle": return hay.includes(qNorm) && !hay.startsWith(qNorm) && !hay.endsWith(qNorm);
        default: return hay.includes(qNorm);
      }
    });

    if(found.length===0){ results.innerHTML="<div class='no-results'>Keine Ergebnisse gefunden.</div>"; return; }

    const h2 = document.createElement("h2");
    h2.textContent = "Ergebnisse";
    results.appendChild(h2);

    found.forEach((e,i)=>{
      const item=document.createElement("div"); item.className="result-item";
      const titleWrap=document.createElement("div"); titleWrap.className="title";
      const a=document.createElement("a"); a.textContent=e.title||"Ohne Titel"; a.href=e.url||"#"; 
      if(a.href.startsWith("http") && !a.href.includes(location.hostname)){a.target="_blank"; a.rel="noopener";}
      titleWrap.appendChild(a);
      const desc=document.createElement("div"); desc.className="desc"; desc.textContent=e.desc||"";
      item.appendChild(titleWrap); item.appendChild(desc); results.appendChild(item);
      if(i<found.length-1){const hr=document.createElement("hr"); hr.className="result-sep"; results.appendChild(hr);}
    });
  }

  function doSearch(){ const term=input.value.trim(); if(!isValidQuery(term)) return; runSearch(term); }

  searchBtn.addEventListener("click", doSearch);
  input.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); doSearch(); } });

  const filterBtn=document.getElementById("filter-button");
  const filterMenu=document.getElementById("filter-menu");
  filterBtn.addEventListener("click",()=>{filterMenu.style.display=filterMenu.style.display==="block"?"none":"block";});
  document.addEventListener("click",e=>{ if(!filterBtn.contains(e.target)&&!filterMenu.contains(e.target)){filterMenu.style.display="none";} });
  filterMenu.addEventListener("change", ()=>{ if(input.value.trim()) runSearch(input.value.trim()); });
</script>
</body>
</html>
