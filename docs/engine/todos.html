<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Meine Todo-Liste</title>
<style>
body { font-family: Arial,sans-serif; background:#f5f5f5; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
h1 { margin:20px 0; color:#333; }
#loginDiv, #todoDiv { background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); width:90%; max-width:400px; }
input { padding:10px; border:1px solid #ccc; border-radius:5px; width:calc(100% - 22px); margin-bottom:10px; }
button { padding:10px 15px; border:none; border-radius:5px; background:#007bff; color:#fff; cursor:pointer; margin-left:5px; }
button:hover { background:#0056b3; }
ul { list-style:none; padding:0; margin:0; }
li { background:#e9ecef; margin-bottom:10px; padding:10px; border-radius:5px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
li.done { text-decoration:line-through; color:#6c757d; background:#d4edda; }
#loginError { color:red; margin-top:5px; text-align:center; }
</style>
</head>
<body>
<h1>Meine Todo-Liste</h1>

<div id="loginDiv">
<input id="password" type="password" placeholder="Passwort">
<button onclick="login()">Login</button>
<p id="loginError"></p>
</div>

<div id="todoDiv" style="display:none">
<input id="newTodo" placeholder="Neues Todo">
<button onclick="addTodo()">Hinzufügen</button>
<ul id="list"></ul>
</div>

<script>
function login() {
    const pw=document.getElementById('password').value;
    fetch('/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pw})})
    .then(res=>{if(res.ok){document.getElementById('loginDiv').style.display='none'; document.getElementById('todoDiv').style.display='block'; loadTodos()} else {document.getElementById('loginError').textContent='Falsches Passwort';}});
}

function loadTodos() {
    fetch('/api/todos').then(res=>res.json()).then(todos=>{
        const list=document.getElementById('list'); list.innerHTML='';
        todos.forEach((t,i)=>{
            const li=document.createElement('li'); li.textContent=t.text; li.className=t.done?'done':'';
            li.onclick=()=>toggleTodo(i,!t.done);
            const del=document.createElement('button'); del.textContent='❌'; del.onclick=e=>{e.stopPropagation(); deleteTodo(i)};
            li.appendChild(del); list.appendChild(li);
        });
    });
}

function addTodo() {
    const text=document.getElementById('newTodo').value;
    if(!text) return;
    fetch('/api/todos',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})}).then(()=>{document.getElementById('newTodo').value=''; loadTodos();});
}
function deleteTodo(i){fetch('/api/todos/'+i,{method:'DELETE'}).then(loadTodos);}
function toggleTodo(i,done){fetch('/api/todos/'+i,{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify({done})}).then(loadTodos);}
</script>
</body>
</html>
