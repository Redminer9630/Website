<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Website-Versionen - Redminer9630</title>
<style>
body { font-family:'Mojangles'; background:#f4f4f4; color:#333; margin:0; padding:20px; }
.version-list { list-style:none; padding:0; }
.version-list li { margin:10px 0; }
.version-list a { text-decoration:none; color:#000; background:#fff; padding:10px 15px; border-radius:5px; display:inline-block; transition:background 0.2s; }
.version-list a:hover { background:#eaeaea; }
#content { margin-top:30px; background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.back-button { text-decoration:none; color:#fff; background:#007bff; padding:10px 15px; border-radius:5px; display:inline-block; margin-top:20px; transition:background 0.2s; }
.back-button:hover { background:#0056b3; }
:root[data-theme="dark"] body { background:#121212; color:#e0e0e0; }
:root[data-theme="dark"] .version-list a { color:#fff; background:#1e1e1e; }
:root[data-theme="dark"] .version-list a:hover { background:#333333; }
:root[data-theme="dark"] #content { background:#1e1e1e; box-shadow:0 2px 5px rgba(0,0,0,0.8); }
:root[data-theme="dark"] .back-button { background:#3399ff; }
:root[data-theme="dark"] .back-button:hover { background:#2277cc; }
</style>
<script type="module" defer src="https://cdn.jsdelivr.net/gh/Redminer9630/Website@t76/docs/autoloader.js"></script>
</head>
<body>
<div id="content">Läd...</div>
<script>
(function(){
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m])); }
  function getParam(name){ return new URL(window.location.href).searchParams.get(name); }
  function createContent(){ let el = document.getElementById("content"); if(!el){ el = document.createElement("div"); el.id = "content"; document.body.appendChild(el); } return el; }

  const versionListHTML = `
    <h2>Website-Versionen</h2>
    <div id="currentVersionBox"></div>
    <ul class="version-list" id="versionList">
      <li><a href="?v=1.pre2">v1.pre2</a></li>
      <li><a href="?v=1.4.0">v1.4.0</a></li>
      <li><a href="?v=1.3.1">v1.3.1</a></li>
      <li><a href="?v=1.3.0">v1.3.0</a></li>
      <li><a href="?v=1.2.0">v1.2.0</a></li>
      <li><a href="?v=1.1.0">v1.1.0</a></li>
      <li><a href="?v=1.0.3">v1.0.3</a></li>
      <li><a href="?v=1.0.2">v1.0.2</a></li>
      <li><a href="?v=1.0.1">v1.0.1</a></li>
      <li><a href="?v=1.0.0">v1.0.0</a></li>
    </ul>
    <h3>Info</h3>
    <p>
      Versionen Zeitstrahl:<br>
      <span>Indev v1.8.4</span><br>
      <span>Alpha v1.4.2</span><br>
      <span>Beta v1.6.7</span><br>
      <span>Pre Release v1.0.3</span><br>
      <span>Release v1.pre2</span><br>
      <span style='color:yellow;'>Full Release</span>
    </p>
  `;

  async function loadVersion(version, pushState = true){
    const contentEl = createContent();
    contentEl.innerHTML = `<p>Lädt Version ${escapeHtml(version)} …</p>`;
    try {
      const url = `https://cdn.jsdelivr.net/gh/Redminer9630/Website/docs/version/${encodeURIComponent(version)}.json`;
      const res = await fetch(url);
      if(!res.ok) throw new Error("Version nicht gefunden.");
      const data = await res.json();
      let changesHTML = "";
      if(Array.isArray(data.changes) && data.changes.length){
        changesHTML = "<h3>Änderungen</h3><ul>" + data.changes.map(c => `<li>${escapeHtml(c)}</li>`).join("") + "</ul>";
      }
      const backHref = window.location.pathname;
      contentEl.innerHTML = `
        <h2>Version: ${escapeHtml(data.version)}</h2>
        <p><strong>Veröffentlicht:</strong> ${escapeHtml(data.date)}</p>
        ${changesHTML}
        <a href="${backHref}" class="back-button">Alle Versionen</a>
      `;
      if(pushState) history.pushState({v:version}, "", "?v=" + encodeURIComponent(version));
    } catch(err) {
      const backHref = window.location.pathname;
      contentEl.innerHTML = `<p style="color:red;">Fehler beim Laden: ${escapeHtml(err.message)}</p><a href="${backHref}" class="back-button">Alle Versionen</a>`;
      if(pushState) history.pushState({}, "", backHref);
    }
  }

  function renderVersionList(){
    const contentEl = createContent();
    contentEl.innerHTML = versionListHTML;
    if(window.CommonVersion && document.getElementById("currentVersionBox")){
      const box = document.getElementById("currentVersionBox");
      box.innerHTML = `
        <div style="padding:10px;background:#e0ffe0;border:1px solid #0a0;border-radius:5px;margin-bottom:15px;">
          <strong>Aktuelle Version:</strong> ${escapeHtml(window.CommonVersion.version)}<br>
          <em>Veröffentlicht:</em> ${escapeHtml(window.CommonVersion.date)}
        </div>
      `;
    }
  }

  document.addEventListener("click", (e) => {
    const a = e.target.closest && e.target.closest("a");
    if(!a) return;
    const href = a.getAttribute("href") || "";
    if(href.startsWith("?v=")){
      e.preventDefault();
      const params = new URLSearchParams(href.replace(/^\?/, ""));
      const v = params.get("v");
      if(v) loadVersion(v);
      return;
    }
    if(a.classList.contains("back-button")){
      e.preventDefault();
      history.pushState({}, "", window.location.pathname);
      renderVersionList();
      return;
    }
  });

  window.addEventListener("popstate", () => {
    const v = getParam("v");
    if(v) loadVersion(v, false);
    else renderVersionList();
  });

  document.addEventListener("DOMContentLoaded", () => {
    const v = getParam("v");
    if(v) loadVersion(v, false);
    else renderVersionList();
  });
})();
</script>
</body>
</html>
