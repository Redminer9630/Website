<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mining Game</title>
    <style>
        body, html {
            margin: 0;
            overflow: hidden;
            background-color: #000;
        }
        canvas { 
            display: block; 
            background-color: lightblue;
            outline: none;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        // Spiellogik Variablen und Canvas-Anpassung
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const TILE_SIZE = 40;
        const WORLD_WIDTH = 100;
        const WORLD_HEIGHT = 100;

        // Texturen und Bilder
        const textures = {
            shop: "images/game/shop.png",
            grass: "images/game/grass.png",
            dirt: "images/game/dirt.png",
            stone: "images/game/stone.png",
            hard_stone: "images/game/hard_stone.png",
            miner_idle: "images/game/miner_idle.png",
            miner_mining: "images/game/miner_mining.png",
            gem: "images/game/gem.png",
            shovel: "images/game/shovel.png",
            pickaxe: "images/game/pickaxe.png",
            drill: "images/game/drill.png",
            laser_drill: "images/game/laser_drill.png"
        };

        const BLOCK_TYPES = {
            AIR: { id: 0, texture: null, hardness: 0 },
            GRASS: { id: 1, texture: textures.grass, hardness: 5 },
            DIRT: { id: 2, texture: textures.dirt, hardness: 6 },
            STONE: { id: 3, texture: textures.stone, hardness: 20 },
            HARD_STONE: { id: 4, texture: textures.hard_stone, hardness: 50 },
        };

        const TOOL_TYPES = {
            SHOVEL: { name: "Schaufel", speed: 1, cost: 0, texture: textures.shovel },
            PICKAXE: { name: "Spitzhacke", speed: 2, cost: 10, texture: textures.pickaxe },
            DRILL: { name: "Bohrer", speed: 3, cost: 20, texture: textures.drill },
            LASER_DRILL: { name: "Laser-Bohrer", speed: 5, cost: 50, texture: textures.laser_drill },
        };

        // Welt und Spieler
        const world = [];
        let player = { x: 0, y: 0, vx: 0, vy: 0, gravity: 0.5, onGround: false, tool: TOOL_TYPES.SHOVEL, gems: 0 };

        function initializeWorld() {
            for (let y = 0; y < WORLD_HEIGHT; y++) {
                const row = [];
                for (let x = 0; x < WORLD_WIDTH; x++) {
                    const blockType = generateRandomBlock();
                    row.push({ type: blockType, hardness: BLOCK_TYPES[blockType].hardness });
                }
                world.push(row);
            }
        }

        function generateRandomBlock() {
            const rand = Math.random();
            if (rand < 0.1) return BLOCK_TYPES.GRASS.id;
            if (rand < 0.3) return BLOCK_TYPES.DIRT.id;
            if (rand < 0.6) return BLOCK_TYPES.STONE.id;
            return BLOCK_TYPES.HARD_STONE.id;
        }

        // Zeichnen der Welt und des Spielers
        function drawWorld() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let y = 0; y < WORLD_HEIGHT; y++) {
                for (let x = 0; x < WORLD_WIDTH; x++) {
                    const block = world[y][x];
                    if (block.type !== BLOCK_TYPES.AIR.id) {
                        const texture = new Image();
                        texture.src = BLOCK_TYPES[block.type].texture;
                        ctx.drawImage(texture, x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                        if (block.hardness < BLOCK_TYPES[block.type].hardness) {
                            ctx.fillStyle = "white";
                            ctx.fillText(block.hardness, x * TILE_SIZE + 10, y * TILE_SIZE + 25);
                        }
                    }
                }
            }
            const minerTexture = new Image();
            minerTexture.src = player.onGround ? textures.miner_idle : textures.miner_mining;
            ctx.drawImage(minerTexture, player.x, player.y, TILE_SIZE, TILE_SIZE);
        }

        // Gravitation und Bewegung
        function applyGravity() {
            player.vy += player.gravity;
            player.y += player.vy;
            if (player.y >= canvas.height - TILE_SIZE) {
                player.y = canvas.height - TILE_SIZE;
                player.vy = 0;
                player.onGround = true;
            } else {
                player.onGround = false;
            }
        }

        // Steuerung und Bewegung
        document.addEventListener("keydown", (e) => {
            if (e.key === "ArrowRight" || e.key === "d") player.vx = 2;
            if (e.key === "ArrowLeft" || e.key === "a") player.vx = -2;
            if ((e.key === "ArrowUp" || e.key === "w") && player.onGround) player.vy = -10;
        });

        document.addEventListener("keyup", (e) => {
            if (e.key === "ArrowRight" || e.key === "ArrowLeft" || e.key === "d" || e.key === "a") player.vx = 0;
        });

        function movePlayer() {
            player.x += player.vx;
            player.x = Math.max(0, Math.min(player.x, canvas.width - TILE_SIZE));
        }

        // Fortschritt speichern
        function saveGame() {
            const gameState = {
                world: world,
                player: player
            };
            localStorage.setItem("miningGameSave", JSON.stringify(gameState));
        }

        setInterval(saveGame, 30000);

        // Hauptspiel-Schleife
        function gameLoop() {
            applyGravity();
            movePlayer();
            drawWorld();
            requestAnimationFrame(gameLoop);
        }

        initializeWorld();
        gameLoop();

    </script>
</body>
</html>
