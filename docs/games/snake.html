<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Snake</title>
  <style>
    :root{--bg:#071326;--panel:#0f2740;--accent:#61dafb;--text:#dff4ff;--muted:rgba(255,255,255,0.75);--panel-border:rgba(255,255,255,0.03)}
    body{margin:0;background:var(--bg);color:var(--text);font-family:sans-serif;display:flex;align-items:center;justify-content:center;height:100vh}
    .panel{background:var(--panel);padding:18px;border-radius:12px;border:1px solid var(--panel-border);box-shadow:0 8px 40px rgba(0,0,0,0.25);display:flex;flex-direction:column;gap:12px;align-items:center}
    canvas{border-radius:8px;background:#000;image-rendering:pixelated}
    .hud{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .stat{padding:6px 10px;border-radius:6px;background:rgba(255,255,255,0.05)}
    .btn{padding:6px 12px;border:none;border-radius:6px;background:var(--accent);color:#fff;cursor:pointer}
    .controls-touch{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:8px}
    .touch-btn{width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:8px;background:rgba(255,255,255,0.08);cursor:pointer}
  </style>
</head>
<body>
  <div class="panel">
    <div class="hud">
      <div class="stat">Score: <strong id="score">0</strong></div>
      <div class="stat">Highscore: <strong id="highscore">0</strong></div>
      <div class="stat">Coins: <strong id="coins">0</strong></div>
      <div class="stat">Level: <strong id="level">1</strong></div>
    </div>
    <canvas id="c"></canvas>
    <div class="hud">
      <button id="restart" class="btn">Neustart</button>
      <button id="pause" class="btn">Pause</button>
      <a href="games.html" class="btn">Upgrades</a>
    </div>
    <div class="controls-touch" id="touchControls" style="display:none;">
      <div class="touch-btn" data-dir="up">▲</div>
      <div style="display:flex;gap:8px;">
        <div class="touch-btn" data-dir="left">◀</div>
        <div class="touch-btn" data-dir="right">▶</div>
      </div>
      <div class="touch-btn" data-dir="down">▼</div>
    </div>
  </div>

<script>
const canvas=document.getElementById("c"),ctx=canvas.getContext("2d");
let scoreEl=document.getElementById("score"),coinsEl=document.getElementById("coins"),levelEl=document.getElementById("level"),highscoreEl=document.getElementById("highscore");
let restartBtn=document.getElementById("restart"),pauseBtn=document.getElementById("pause");

let upgrades=JSON.parse(localStorage.getItem("upgrades")||"{}");
let baseCols=20,baseRows=20,pixel=20;
let cols=baseCols+(upgrades.field||0)*2,rows=baseRows+(upgrades.field||0)*2;
canvas.width=cols*pixel;canvas.height=rows*pixel;

let snake=[{x:10,y:10}],dir={x:0,y:0},food={x:5,y:5};
let score=0,coins=parseInt(localStorage.getItem("coins")||"0");
let level=parseInt(localStorage.getItem("level")||"1");
let running=true,loopId=null,delay=200,collidedIndex=null,extraLife=!!upgrades.life;

if(upgrades.speed){delay=Math.max(100,delay-40);}

function randPos(){return {x:Math.floor(Math.random()*cols),y:Math.floor(Math.random()*rows)};}
function placeFood(){let p;do{p=randPos();}while(snake.some(s=>s.x===p.x&&s.y===p.y));food=p;}

function draw(){
  ctx.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--bg")||"#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#ff6b6b";ctx.fillRect(food.x*pixel+2,food.y*pixel+2,pixel-4,pixel-4);
  for(let i=0;i<snake.length;i++){
    let s=snake[i],color=i===0?"#fff":"#0af";ctx.fillStyle=color;
    ctx.fillRect(s.x*pixel+1,s.y*pixel+1,pixel-2,pixel-2);
  }
}
function update(){
  if(dir.x===0&&dir.y===0)return;
  const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
  if(head.x<0)head.x=cols-1;if(head.x>=cols)head.x=0;if(head.y<0)head.y=rows-1;if(head.y>=rows)head.y=0;
  const idx=snake.findIndex(s=>s.x===head.x&&s.y===head.y);
  if(idx!==-1){
    if(extraLife){extraLife=false;snake=[{x:10,y:10}];dir={x:0,y:0};return;}
    running=false;handleHighscore();return;
  }
  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y){
    score++;coins++;localStorage.setItem("coins",coins);
    placeFood();updateHUD();
  }else snake.pop();
}
function handleHighscore(){let hs=parseInt(localStorage.getItem("snake_highscore")||"0");if(score>hs){localStorage.setItem("snake_highscore",score);highscoreEl.textContent=score;alert("Neuer Highscore: "+score);}}
function updateHUD(){scoreEl.textContent=score;coinsEl.textContent=coins;levelEl.textContent=level;highscoreEl.textContent=localStorage.getItem("snake_highscore")||0;}
function gameLoop(){if(!running){draw();clearTimeout(loopId);loopId=null;return;}update();draw();clearTimeout(loopId);loopId=setTimeout(gameLoop,delay);}

window.addEventListener("keydown",e=>{
  const k=e.key;let nx=dir.x,ny=dir.y;
  if(k==="ArrowUp"||k==="w"){nx=0;ny=-1}
  if(k==="ArrowDown"||k==="s"){nx=0;ny=1}
  if(k==="ArrowLeft"||k==="a"){nx=-1;ny=0}
  if(k==="ArrowRight"||k==="d"){nx=1;ny=0}
  if((nx===-dir.x&&ny===-dir.y)||(nx===dir.x&&ny===dir.y))return;
  dir={x:nx,y:ny};if(running&&loopId===null)loopId=setTimeout(gameLoop,delay);
});

restartBtn.addEventListener("click",()=>{reset()});
pauseBtn.addEventListener("click",()=>{running=!running;if(running){pauseBtn.textContent="Pause";loopId=setTimeout(gameLoop,delay)}else{pauseBtn.textContent="Weiter";clearTimeout(loopId);loopId=null}});
function reset(){snake=[{x:10,y:10}];dir={x:0,y:0};placeFood();score=0;running=true;updateHUD();clearTimeout(loopId);loopId=setTimeout(gameLoop,delay);}

function setupTouch(){const tc=document.getElementById("touchControls");if("ontouchstart" in window){tc.style.display="flex";tc.querySelectorAll(".touch-btn").forEach(b=>{b.addEventListener("click",()=>{const d=b.dataset.dir;const map={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]};const [nx,ny]=map[d];if(nx===-dir.x&&ny===-dir.y)return;dir={x:nx,y:ny};if(loopId===null)loopId=setTimeout(gameLoop,delay)})})}}
placeFood();updateHUD();setupTouch();loopId=setTimeout(gameLoop,delay);
</script>
</body>
</html>
